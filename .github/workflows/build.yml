name: C/C++ CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-16.04
    
    steps:
    - uses: actions/checkout@v1
    - name: Install depds
      run: |
        sudo echo "deb http://dl.bintray.com/jasonbeverage/pelicanmapping trusty main" | sudo tee -a /etc/apt/sources.list
        sudo apt-get update -qq
        sudo apt-get install -y cmake
        sudo apt-get install -y --force-yes openscenegraph=3.4.1
        sudo apt-get install -y libgdal-dev
        sudo apt-get install -y libgeos-dev
        sudo apt-get install -y libsqlite3-dev
        sudo apt-get install -y protobuf-compiler libprotobuf-dev
        sudo apt-get install -y libpoco-dev
    - name: Generate project files
      run: cmake -DCMAKE_BUILD_TYPE=Release .
    - name: build and install
      run: make -j3 && make install && ldconfig
    - name: test
      run: cd tests && osgEarth_tests